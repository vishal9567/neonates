<section class="bg-light py-5" style="margin-top: 100px;">
  <div class="container">
    <div class="row">
      <div class="col-xl-8 col-lg-8 mb-4">
        {{#if addressOne}}
        <div class="card mb-4 border shadow-0">
          <div class="p-4 d-flex justify-content-between">
            <div class="">
              <h5>You can add one more address</h5>

            </div>
            <div class="d-flex align-items-center justify-content-center flex-column flex-md-row">
              <a href="/addAddress2" class="btn btn-outline-primary me-0 me-md-2 mb-2 mb-md-0 w-100">Add</a>

            </div>
          </div>
        </div>
        {{/if}}

        {{#if addresszero}}
        <div class="card mb-4 border shadow-0">
          <div class="p-4 d-flex justify-content-between">
            <div class="">
              <h5>Add delivery address</h5>

            </div>
            <div class="d-flex align-items-center justify-content-center flex-column flex-md-row">
              <a href="/addAddress2" class="btn btn-outline-primary me-0 me-md-2 mb-2 mb-md-0 w-100">Add</a>

            </div>
          </div>
        </div>
        {{/if}}


        <!-- Checkout -->
        <div class="card shadow-0 border">
          <div class="p-4">
            <h5 class="card-title mb-3">Address Details</h5>
            <div class="row mb-3">
              {{#each userData}}
              <div class="col-lg-6 mb-3">
                <!-- Default checked radio -->
                <div class="form-check h-100 border rounded-3">
                  <div class="p-3">
                    <input class="form-check-input getAddress" type="radio" name="address" value="{{this._id}}"
                      id="flexRadioDefault1{{this._id}}" checked />
                    <label class="form-check-label" for="flexRadioDefault1{{this._id}}">
                      {{this.country}}<br />
                      <small class="text-muted">{{this.state}},</small>
                      <small class="text-muted">{{this.district}},</small>
                      <small class="text-muted">{{this.city}},</small>
                      <small class="text-muted">{{this.pinCode}},</small>
                      <small class="text-muted">{{this.phone}}</small>
                    </label>
                  </div>
                </div>
              </div>
              {{/each}}

            </div>

            <!--  <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
              <label class="form-check-label" for="flexCheckDefault">Keep me up to date on news</label>
            </div> -->

            <hr class="my-4" />
            <input id="getUserId" type="text" value="{{userDetail._id}}" hidden>



            <!-- <div class="row mb-3">
              <div class="col-lg-4 mb-3">
                <!-- Default checked radio --
                <div class="form-check h-100 border rounded-3">
                  <div class="p-3">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked />
                    <label class="form-check-label" for="flexRadioDefault1">
                      Express delivery <br />
                      <small class="text-muted">3-4 days via Fedex </small>
                    </label>
                  </div>
                </div>
              </div>
              <div class="col-lg-4 mb-3">
                <!-- Default radio --
                <div class="form-check h-100 border rounded-3">
                  <div class="p-3">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" />
                    <label class="form-check-label" for="flexRadioDefault2">
                      Post office <br />
                      <small class="text-muted">20-30 days via post </small>
                    </label>
                  </div>
                </div>
              </div>
              <div class="col-lg-4 mb-3">
                <!-- Default radio --
                <div class="form-check h-100 border rounded-3">
                  <div class="p-3">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault3" />
                    <label class="form-check-label" for="flexRadioDefault3">
                      Self pick-up <br />
                      <small class="text-muted">Come to our shop </small>
                    </label>
                  </div>
                </div>
              </div>
            </div> 

          <!--  <div class="row">
              <div class="col-sm-8 mb-3">
                <p class="mb-0">Address</p>
                <div class="form-outline">
                  <input type="text" id="typeText" placeholder="Type here" class="form-control" />
                </div>
              </div>

              <div class="col-sm-4 mb-3">
                <p class="mb-0">City</p>
                <select class="form-select">
                  <option value="1">New York</option>
                  <option value="2">Moscow</option>
                  <option value="3">Samarqand</option>
                </select>
              </div>

              <div class="col-sm-4 mb-3">
                <p class="mb-0">House</p>
                <div class="form-outline">
                  <input type="text" id="typeText" placeholder="Type here" class="form-control" />
                </div>
              </div>

              <div class="col-sm-4 col-6 mb-3">
                <p class="mb-0">Postal code</p>
                <div class="form-outline">
                  <input type="text" id="typeText" class="form-control" />
                </div>
              </div>

              <div class="col-sm-4 col-6 mb-3">
                <p class="mb-0">Zip</p>
                <div class="form-outline">
                  <input type="text" id="typeText" class="form-control" />
                </div>
              </div>
            </div>

            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" />
              <label class="form-check-label" for="flexCheckDefault1">Save this address</label>
            </div>

            <div class="mb-3">
              <p class="mb-0">Message to seller</p>
              <div class="form-outline">
                <textarea class="form-control" id="textAreaExample1" rows="2"></textarea>
              </div>
            </div>-->

            <div class="float-end">
              <button type="button" id="editAddress" class="btn btn-info me-5">Edit</button>
              <button type="button" id="deleteAddress" class="btn btn-danger me-5">Delete</button>
              <!-- <button class="btn btn-light border">Cancel</button> -->
            </div>
          </div>
        </div>
        <!-- Checkout -->
      </div>
      <div class="col-md-4 mb-4">
        <div class="card mb-4">
          <div class="card-header py-3">
            <h5 class="mb-0">Manage Address</h5>
          </div>
          <div class="card-body">
            <form id='editUserAddress'>
              <!-- 2 column grid layout with text inputs for the first and last names -->
              <div class="row mb-4">
                <div class="col">
                  <div class="form-outline">
                    <input type="text" id="form7Example1" class="form-control" name="country" />
                    <label class="form-label" for="form7Example1">contry</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-outline">
                    <input type="text" id="form7Example2" class="form-control" name="state" />
                    <label class="form-label" for="form7Example2">State</label>
                  </div>
                </div>
              </div>

              <div class="row mb-4">
                <div class="col">
                  <div class="form-outline">
                    <input type="text" id="form7Example3" class="form-control" name="district" />
                    <label class="form-label" for="form7Example1">District</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-outline">
                    <input type="text" id="form7Example4" class="form-control" name="city" />
                    <label class="form-label" for="form7Example2">City</label>
                  </div>
                </div>
              </div>


              <!-- Number input -->
              <div class="form-outline mb-4">
                <input type="number" id="form7Example5" class="form-control" name="pinCode" />
                <label class="form-label" for="form7Example6">Pin code</label>
              </div>
              <!-- Number input -->
              <div class="form-outline mb-4">
                <input type="number" id="form7Example6" class="form-control" name="phone" />
                <label class="form-label" for="form7Example6">Phone</label>
              </div>
              <button type="submit" class="btn btn-primary btn-lg btn-block">
                Submit
              </button>
            </form>


          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<!-- Footer -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.js"></script>
<script>
  let flag = 0;
  $('#editAddress').click(function (e) {
    e.preventDefault();
    let addressId = $('.getAddress:checked').val();

    $.ajax({
      url: '/editAddress',
      data: {
        addressId: addressId
      },
      method: 'post',
      success: (function (response) {
        flag = 1;
        let country = document.getElementById('form7Example1')
        let state = document.getElementById('form7Example2')
        let disctrict = document.getElementById('form7Example3')
        let city = document.getElementById('form7Example4')
        let pin = document.getElementById('form7Example5')
        let phone = document.getElementById('form7Example6')
        country.value = response.address.country
        state.value = response.address.state
        disctrict.value = response.address.district
        city.value = response.address.city
        pin.value = response.address.pinCode
        phone.value = response.address.phone
      })
    })
  })
      const $form = $('#editUserAddress')
      $form.on('submit', submitHandler)
      function submitHandler(e) {
        e.preventDefault()
        if (flag == 1) {

          $.ajax({
            url: '/editAddressSubmit',
            type: 'POST',
            data: $form.serialize()
          }).done(response => {
            if (!response.validation) {
              Swal.fire({
                title: 'Empty fields!',
                text: 'Fill in all fields',
                icon: 'info',
                timer: 3000
              })
            }
            else {
              Swal.fire({
                title: 'Address updated!',
                text: 'Address has been updated succesfully.',
                icon: 'success',
                timer: 3000
              }).then(() => {
                location.reload();
              })
            }
          })
        }
        else if(flag  == 0){
          $.ajax({
            url:'/addAddress',
            type:'POST',
            data:$form.serialize()
          }).done(response =>{
             if (!response.validation) {
              Swal.fire({
                title: 'Empty fields!',
                text: 'Fill in all fields',
                icon: 'info',
                timer: 3000
              })
            }
            else {
              Swal.fire({
                title: 'Address created!',
                text: 'Address has been added succesfully.',
                icon: 'success',
                timer: 3000
              }).then(() => {
                location.reload();
              })
            }
          })
        }
      }
</script>

<script>
  $('#deleteAddress').click(function (e) {
    let ok = confirm("are you want to delete this address")
    e.preventDefault();
    if (ok) {
      let addressId = $('.getAddress:checked').val();
      let userid = document.getElementById('getUserId')

      $.ajax({
        url: '/deleteAddress',
        data: {
          addressId: addressId,
          userId: userid.value
        },
        method: 'post',
        success: (function (response) {
          Swal.fire({
            title: 'Address Deleted!',
            text: 'Address has been deleted succesfully.',
            icon: 'success',
            timer: 3000
          }).then(() => {
            location.reload();
          })
        })
      })
    }

  })
</script>
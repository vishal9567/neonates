<section style="margin-top: 150px;">
    <div class="container" style="margin-top: 30px;">
        <!-- <form action="/admin/searchUser" method="post">
            <div class="input-group mb-4">
                <input id="searchVal" name="user_search" type="search" placeholder="Search here..." aria-describedby="button-addon5"
                    class="form-control">
                <div class="input-group-append">
                    <button id="button-addon5" type="submit" class="btn btn-primary"> <i class="fa fa-search">Search</i> </button> 
                </div>
            </div>
        </form> 
        {{#if searchFailed}}
        <center class="text-danger bg-warning">No such entry</center>
        {{/if}}-->
        <table class="table table-bordered text-center" id="productsTable">
            <thead style="background-color: rgb(236,79,162)">
                <tr>
                    <th>Order</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Order Date</th>
                    <th>Payment Method</th>
                    <th>Order Status</th>
                    <th>Options</th>
                </tr>
            </thead>
            {{!-- <tfoot>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Options</th>
                </tr>
            </tfoot> --}}
            {{#each data}}
            <tbody>
                <tr style="background-color: rgb(242, 197, 210);">
                    <td><a href="/showProducts/{{this._id}}" class="text-decoration-none">
                            <h6 class="text-primary">{{this._id}}</h6>
                        </a></td>
                    <td>{{this.quantity}}</td>
                    <td>{{this.totalAmount}}</td>
                    <td>{{this.date}}</td>
                    <td>{{this.paymentMethod}}</td>
                    <td>
                        <div>
                            {{#if this.cancelStatus}}<h6 {{#if this.status}} class="text-success" {{else}} class="text-warning" {{/if}}>{{#if
                                this.status}}Placed{{else}}Pending{{/if}}</h6>{{else}} <h6 class="text-warning">Cancelled</h6>{{/if}}
                        </div>
                    </td>
                    <td>
                        <div class="dropdown">
                            <button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown">
                            
                            </button>
                            <ul class="dropdown-menu">
                                <li><button class="dropdown-item" onclick="cancelOrder('{{this._id}}','{{this.cancelStatus}}')">{{#if cancelStatus}}Cancel Order{{else}}Place order{{/if}}</button></li>
                                <li><a class="dropdown-item" href="/showProducts/{{this._id}}">Order Details</a></li>
                                <li><a class="dropdown-item" href="#">Link 3</a></li>
                            </ul>
                        </div>
                    </td>
                </tr>

            </tbody>
            {{/each}}
        </table>

    </div>
    <div class="container d-flex justify-content-end">
        <sub class="fas fa-long-arrow-alt-left me-2 text-success"></sub><a class="text-dark " href="/userDashBoard">Back to account</a>
    </div>
</section>

    <script>
        function cancelOrder(orderid, orderStat) {

            $.ajax({
                url: '/cancelOrder',
                data: {
                    orderId:orderid,
                    orderStatus:orderStat
                },
                method: 'post',
                success: (function (response) {
                    if (response.removeProduct) {
                        alert("Status changed")
                        location.reload()
                    }
                    else {
                        location.reload()
                    }
                })
            })
        }
    </script>
<!--modal-->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header " style="color: rgb(236,79,162);">
                <h5 class="modal-title" id="exampleModalLabel">Share</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body"></div>
            <!-- <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div> -->
        </div>
    </div>
</div>
<!--modal ends-->

<div class="container mb-5" style="margin-top: 160px;">
    <div class="row d-flex justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="row">
                    <div class="col-md-6">
                        <div class="images p-3">
                            <div class="text-center p-4"> <img id="main-image" src="/images/{{product.image.[0]}}"
                                    width="250" /> </div>
                            <div class="thumbnail text-center"> <img onclick="change_image(this)"
                                    src="/images/{{product.image.[0]}}" width="70"> <img onclick="change_image(this)"
                                    src="/images/{{product.image.[1]}}" width="70"> </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="product p-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center"> <i class="fa fa-long-arrow-left"></i> <a
                                        href="/landing" class="text-decoration-none"><span class="ml-1">Back</span></a>
                                </div> <a {{#if user}}href="/cart" {{else}} onclick="showAlert()" {{/if}}><i
                                        class="fa fa-shopping-cart text-muted"></i></a>
                            </div>
                            <div class="mt-4 mb-3"> <span
                                    class="text-uppercase text-muted brand">{{product.brandname}}</span>
                                <h5 class="text-uppercase">{{product.productname}}</h5>
                                <div class="price d-flex flex-row align-items-center"> <span class="act-price"></span>
                                    <div class="ml-2"> <small class="dis-price"></small> <span></span> </div>
                                </div>
                            </div>
                            <p class="about">{{product.discription}}</p>

                            <div class="cart mt-4 align-items-center">
                                <button class="btn btn-danger text-uppercase mr-2 px-4"
                                    onclick="addtocart('{{product._id}}','{{user}}')">Add to
                                    cart</button> <a {{#if user}}href="/wishlist" {{else}}onclick="showAlert()"
                                    {{/if}}><i class="fa fa-heart text-muted"></i></a>
                                <i class="fa fa-share-alt text-muted" onclick="share()"></i>
                                <button class="btn btn-warning text-uppercase mr-2 px-4"
                                    onclick="addtowhishlist('{{product._id}}','{{product.productname}}','{{product.brandname}}','{{product.image.[0]}}',{{product.price}},'{{user}}')">Add
                                    to
                                    whishlist</button>
                            </div>

                            <div class="pt-5 pe-5">
                                <div class="d-flex  mb-2">
                                    <span class="text-secondary fw-bold">Apply rating:</span>
                                    <div class="ms-auto pe-5" id="mainDiv">
                                        <i class="fas fa-star" id="1" onclick="applyRating(1, '{{product._id}}')"></i>
                                        <i class="fas fa-star" id="2" onclick="applyRating(2, '{{product._id}}')"></i>
                                        <i class="fas fa-star" id="3" onclick="applyRating(3, '{{product._id}}')"></i>
                                        <i class="fas fa-star" id="4" onclick="applyRating(4, '{{product._id}}')"></i>
                                        <i class="fas fa-star" id="5" onclick="applyRating(5, '{{product._id}}')"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Carousel -->
{{#if banner}}
<div id="demo" class="carousel slide" data-bs-ride="carousel">

    <!-- Indicators/dots -->
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#demo" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#demo" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#demo" data-bs-slide-to="2"></button>
    </div>

    <!-- The slideshow/carousel -->
    <div class="carousel-inner" style="height: 400px;">
        <div class="carousel-item active">
            <img src="/images/{{banner.image.[0]}}" alt="Los Angeles" class="d-block w-100 " style="height:400px">
        </div>
        <div class="carousel-item">
            <img src="/images/{{banner.image.[1]}}" alt="Chicago" class="d-block w-100 img-fluid" style="height:400px">
        </div>
        <div class="carousel-item">
            <img src="/images/{{banner.image.[2]}}" alt="New York" class="d-block w-100 img-fluid" style="height:400px">
        </div>
    </div>

    <!-- Left and right controls/icons -->
    <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>{{/if}}



<!--html end-->

<script>
    function change_image(image) {

        var container = document.getElementById("main-image");

        container.src = image.src;
    }



    document.addEventListener("DOMContentLoaded", function (event) {

    });
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.js"></script>

<script>
    function addtocart(id, user) {
        $.ajax({
            url: '/addToCart/' + id,
            method: 'get',
            success: (function (response) {
                if (user) {
                    if (response.cartAdded) {
                        Swal.fire({
                            title: 'Added to cart!',
                            text: 'Product has been added to cart succesfully.',
                            icon: 'success',
                            timer: 5000
                        })
                    }
                    else if (response.productEmpty) {
                        Swal.fire({
                            title: 'Product not available',
                            text: 'Sorry for the trouble',
                            icon: 'info',
                            timer: 5000
                        })
                    }
                }
                else {
                    Swal.fire({
                        title: 'Please login',
                        text: 'Signup or login',
                        icon: 'info',
                        timer: 5000
                    }).then(function () {
                        window.location.href = "http://localhost:3000/userLogin"
                    })
                }

            })
        })

    }
</script>

<script>
    function addtowhishlist(id, proname, probrand, proimg, proprice, user) {
        $.ajax({
            url: '/addToWhishlist?id=' + id + '&proname=' + proname + '&probrand=' + probrand + '&proimg=' + proimg + '&proprice=' + proprice,
            method: 'get',
            success: (function (response) {
                if (user) {
                    Swal.fire({
                        title: 'Added to Whishlist!',
                        text: 'Product has been added to whishlist succesfully.',
                        icon: 'success',
                        timer: 5000
                    })
                }
                else {
                    Swal.fire({
                        title: 'Please login',
                        text: 'Signup or login',
                        icon: 'info',
                        timer: 5000
                    }).then(function () {
                        window.location.href = "http://localhost:3000/userLogin"
                    })
                }

            })
        })

    }
    function showAlert() {
        alert("Please Login or Signup")
        window.location = 'http://localhost:3000/userLogin'
    }
</script>
<!--for modal-->
<script>
    function share() {
        // alert(window.location.href)
        $('#exampleModal').modal('show')
        $('#exampleModal').find('.modal-body').empty();
        $('#exampleModal').find('.modal-body').append(`<input class="form-control fw-bold p-3" style="border:none; color: blue" id="link" value="${window.location.href}"><br> 
        <a onclick="copy('link',1)" ><img class="p-2" src="/img/icons8-whatsapp-48.png"></a> <a onclick="copy('link',2)"><img src="/img/icons8-gmail-48.png"></a>`);
        $('.btn-close').click(() => {
            $('#exampleModal').modal('hide')
        })


    }
    function copy(id, num) {
        let text = document.getElementById(id)
        //alert(text.value)
        text.select();
        navigator.clipboard.writeText(text.value);
        if (num == 1) {
            setTimeout(function () {

                window.open('https://api.whatsapp.com/send')
            }, 1)
        } else if (num == 2) {
            setTimeout(function () {

                window.open('https://mail.google.com/mail/?view=cm&fs=1&to=email@domain.example')
            }, 1)
        }

    }

    function likeProduct(proId) {
        $.ajax({
            url: '/likeProduct?proId=' + proId,
            method: 'get',
            success: (function (response) {
                if (response.liked)
                    alert('Already liked')
            })
        })
    }
    function applyRating(rating, proId) {
        let value = document.getElementById(rating).className
        document.getElementById(rating).className = 'fas fa-star text-warning'
        if (value == 'fas fa-star text-warning') {
            document.getElementById(rating).className = 'fas fa-star'
            let nodeId = document.querySelector('#mainDiv').querySelectorAll('i')
            let flag = 0;
            for (let i = 0; i < nodeId.length; i++) {
                if (nodeId[i].className != 'fas fa-star text-warning') {
                    flag = 1
                }
                if (flag == 1) {
                    nodeId[i].className = 'fas fa-star'
                }
            }
        }
        else {
            let nodeId = document.querySelector('#mainDiv').querySelectorAll('i')
            let flag = 0;
            for (let i = 0; i < nodeId.length; i++) {
                if (nodeId[i].className != 'fas fa-star text-warning') {
                    flag = 1
                }
                if (flag == 1) {
                    nodeId[i].className = 'fas fa-star'
                }
            }
        }
    }
</script>